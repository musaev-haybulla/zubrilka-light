# Руководство по использованию админ-панели

## Доступ к админ-панели

**URL**: http://localhost:8080/admin.php

## Добавление нового стиха

### 1. Выберите категорию
Выберите категорию из выпадающего списка

### 2. Введите название
Например: "Письмо Татьяны к Онегину"

### 3. Описание (необязательно)
Краткое описание стиха

### 4. Текст стиха с таймкодами

**Формат**: каждая строка заканчивается таймкодом в секундах

**Пример:**
```
Я Вам пишу, чего же боле 2.54
Что я могу еще сказать 3.45
Теперь я знаю, в Вашей воле 5.1
Меня презреньем наказать 7

Но вы к моей несчастной доле 8.51
Хоть каплю жалости храня 10.11
```

**Правила:**
- Каждая строка: `Текст строки ПРОБЕЛ таймкод`
- Таймкод в секундах (можно с дробной частью: `2.54`)
- **Пустая строка** = конец параграфа для предыдущей строки
- Последняя строка автоматически помечается как конец параграфа

### 5. Загрузите аудиофайл

- Формат: **MP3**
- Максимальный размер: **50 МБ**
- Файл должен соответствовать таймкодам в тексте

### 6. Нажмите "Добавить стих"

Система автоматически:
- ✅ Создаст запись в таблице `poems`
- ✅ Разобьёт текст на части (`verses`)
- ✅ Сохранит аудиофайл в `/media/{номер_стиха}/{номер_стиха}.mp3`
- ✅ Присвоит порядковый номер

## Что происходит при добавлении

1. **Парсинг текста**: система разбирает текст построчно и извлекает таймкоды
2. **Создание записи**: добавляется запись в таблицу `poems`
3. **Добавление частей**: каждая строка сохраняется в таблицу `verses`
4. **Загрузка аудио**: MP3 файл сохраняется в `/media/`

## Структура хранения

```
media/
├── 1/
│   └── 1.mp3
├── 2/
│   └── 2.mp3
└── 3/
    └── 3.mp3
```

## Формат таймкодов

Таймкоды указывают момент **окончания** строки в аудиофайле:

```
Строка 1 2.54    ← эта строка заканчивается на 2.54 секунде
Строка 2 5.1     ← эта строка заканчивается на 5.1 секунде
```

## Добавление категорий

Категории добавляются напрямую в БД через phpMyAdmin:

1. Откройте http://localhost:8081
2. Войдите (root / root)
3. Выберите БД `poems_db`
4. Таблица `categories`
5. Вставьте новую запись:
   - `name`: название категории
   - `sort_order`: порядок сортировки

## Ошибки и их решение

### "Не удалось создать директорию"
- Проверьте права доступа к папке `/media/`
- В Docker это должно работать автоматически

### "Разрешены только MP3 файлы"
- Убедитесь что загружаете именно MP3
- Проверьте расширение файла

### "Не удалось распарсить текст стиха"
- Проверьте формат: `Текст ПРОБЕЛ таймкод`
- Убедитесь что таймкоды - это числа
- Пример правильного формата выше

### "Ошибка БД"
- Проверьте подключение к БД
- Убедитесь что таблицы созданы
- Проверьте логи: `docker-compose logs db`

## Безопасность

⚠️ **ВАЖНО**: В продакшене добавьте авторизацию!

Сейчас админ-панель доступна всем. Для продакшена:
1. Добавьте систему авторизации
2. Или защитите через `.htpasswd`
3. Или ограничьте доступ по IP

## Пример использования

1. Откройте http://localhost:8080/admin.php
2. Выберите категорию "Русская классика"
3. Название: "Евгений Онегин - Письмо Татьяны"
4. Вставьте текст с таймкодами
5. Загрузите MP3 файл
6. Нажмите "Добавить стих"
7. Перейдите по ссылке чтобы посмотреть результат
