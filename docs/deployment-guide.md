# Руководство по деплою Zubrilka Light

## Краткий процесс деплоя

### 1. Подготовка
```bash
# Проверить статус git
just git-status

# Убедиться что все изменения закоммичены
git add .
git commit -m "Описание изменений"
```

### 2. Создание архива
```bash
# Создать архив для загрузки на хостинг
just deploy-archive

# Или tar.gz (альтернатива)
just deploy-tar
```

### 3. Экспорт базы данных
```bash
# Экспортировать БД (если были изменения в структуре/данных)
just db-export zubrilka
```

### 4. Полный деплой (архив + БД)
```bash
# Одной командой
just deploy-full zubrilka
```

Результат: два файла готовы для загрузки на хостинг:
- `zubrilka-deploy-YYYYMMDD-HHMMSS.zip`
- `db-backup-YYYYMMDD-HHMMSS.sql`

## Деплой через SSH (если есть доступ к серверу)

### Вариант 1: Git Pull
```bash
# Если на сервере настроен git
just deploy-ssh example.com username /var/www/zubrilka
```

### Вариант 2: Rsync
```bash
# Прямая синхронизация файлов
just deploy-rsync example.com username /var/www/zubrilka
```

### Вариант 3: Через .env файл
```bash
# 1. Создать .env с настройками
cat > .env << EOF
DEPLOY_HOST=example.com
DEPLOY_USER=username
DEPLOY_PATH=/var/www/zubrilka
EOF

# 2. Деплой одной командой
just deploy
```

## Загрузка на хостинг вручную

### Шаг 1: Загрузка файлов
1. Создать архив: `just deploy-archive`
2. Загрузить через FTP/панель хостинга
3. Распаковать на сервере

### Шаг 2: Настройка БД
1. Создать базу данных на хостинге
2. Импортировать `db-backup-*.sql` через phpMyAdmin
3. Обновить `includes/config.php` с данными БД хостинга

### Шаг 3: Права доступа
```bash
# На сервере (через SSH)
find . -type f -exec chmod 644 {} \;
find . -type d -exec chmod 755 {} \;
```

Или локально перед архивацией:
```bash
just fix-permissions
```

## Проверка после деплоя

1. Открыть главную страницу
2. Проверить список стихов
3. Открыть любой стих и проверить воспроизведение
4. Проверить админ-панель (если нужно)

## Полезные команды

```bash
# Показать все команды
just

# Размер проекта
just size

# Очистка временных файлов
just clean

# Проверка прав доступа
just check-permissions

# Локальный тест-сервер
just serve 8000
```

## Чек-лист перед деплоем

- [ ] Все изменения закоммичены
- [ ] Протестировано локально
- [ ] Обновлена документация (если нужно)
- [ ] Создан бэкап текущей версии на сервере
- [ ] Проверены права доступа к файлам
- [ ] Обновлён `includes/config.php` для продакшена

## Откат изменений

Если что-то пошло не так:

1. **Через git** (если деплой через SSH):
   ```bash
   ssh user@host "cd /var/www/zubrilka && git reset --hard HEAD~1"
   ```

2. **Вручную**: загрузить предыдущий архив

3. **БД**: импортировать предыдущий бэкап через phpMyAdmin
