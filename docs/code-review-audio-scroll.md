# –ö–æ–¥-—Ä–µ–≤—å—é: –∞—É–¥–∏–æ –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∫

## 1. –õ–∏—à–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è / —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥

### ‚ùå –î—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è setTimeout (—Å—Ç—Ä–æ–∫–∏ 460-480)
```javascript
setTimeout(function() {
    console.log('üîç 100ms after play() - checking state:');
    sound.volume(1.0);  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
    Howler.volume(1.0);
    
    if (loop) {
        monitorLoop();
    } else {
        monitorOnce();
    }
}, 100);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –î—É–±–ª–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ - —Å—Ç–∞—Ä—ã–π –∫–æ—Å—Ç—ã–ª—å (–≥—Ä–æ–º–∫–æ—Å—Ç—å —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ —Å—Ç—Ä–æ–∫–µ 439)
- monitorLoop –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å—Ä–∞–∑—É, –Ω–µ –∂–¥–∞—Ç—å 100–º—Å

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–±—Ä–∞—Ç—å setTimeout, –∑–∞–ø—É—Å–∫–∞—Ç—å monitorLoop —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ play()

---

## 2. –ö–æ—Å—Ç—ã–ª–∏ (—Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–æ—Å–º—ã—Å–ª–µ–Ω–∏—è)

### üîß –ö–æ—Å—Ç—ã–ª—å #1: –ó–∞–¥–µ—Ä–∂–∫–∞ 150–º—Å –ø–µ—Ä–µ–¥ startHighlighting (—Å—Ç—Ä–æ–∫–∞ 452)
```javascript
setTimeout(function() {
    startHighlighting();
}, 150);
```

**–ü—Ä–∏—á–∏–Ω–∞:** HTML5 Audio –Ω–µ —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `playing: true`

**–°–∏—Å—Ç–µ–º–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ Howler `onplay` –≤–º–µ—Å—Ç–æ —Ç–∞–π–º–µ—Ä–∞
- –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å `sound.playing()` –≤ RAF warmup —Ñ–∞–∑–µ (—É–∂–µ –µ—Å—Ç—å)

### üîß –ö–æ—Å—Ç—ã–ª—å #2: –§–ª–∞–≥ isRewinding —Å setTimeout (—Å—Ç—Ä–æ–∫–∞ 344)
```javascript
isRewinding = true;
setTimeout(function() {
    isRewinding = false;
}, 300);
```

**–ü—Ä–∏—á–∏–Ω–∞:** `seek()` –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `playing: true`

**–°–∏—Å—Ç–µ–º–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ Howler `onseek` 
- –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á—Ç–æ seek –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ

### üîß –ö–æ—Å—Ç—ã–ª—å #3: Warmup —Ñ–∞–∑–∞ 300–º—Å –≤ RAF (—Å—Ç—Ä–æ–∫–∞ 701)
```javascript
var elapsedSinceStart = now - rafStartTime;
var isWarmupPhase = elapsedSinceStart < 300;
```

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–∞ –∂–µ - HTML5 Audio –º–µ–¥–ª–µ–Ω–Ω–æ —Å—Ç–∞—Ä—Ç—É–µ—Ç

**–°–∏—Å—Ç–µ–º–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –í—Å–µ —Ç—Ä–∏ –∫–æ—Å—Ç—ã–ª—è —Ä–µ—à–∞—é—Ç—Å—è –æ–¥–Ω–∏–º —Å–ø–æ—Å–æ–±–æ–º - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è Howler –≤–º–µ—Å—Ç–æ —Ç–∞–π–º–µ—Ä–æ–≤

---

## 3. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ #1: –ì–æ–Ω–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤
```javascript
setTimeout(startHighlighting, 150);  // –ó–∞–ø—É—Å–∫ RAF
setTimeout(monitorLoop, 100);         // –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
setTimeout(isRewinding = false, 300); // –°–±—Ä–æ—Å —Ñ–ª–∞–≥–∞
```

**–†–∏—Å–∫:** –ï—Å–ª–∏ –∑–≤—É–∫ –æ—Å—Ç–∞–Ω–æ–≤—è—Ç –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–æ–≤ - —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑–æ–≤—É—Ç—Å—è —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–º–µ–Ω—è—Ç—å –≤—Å–µ setTimeout –ø—Ä–∏ `stopHighlighting()`

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ #2: visitedStanzas –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ stop
```javascript
function stopHighlighting() {
    // –ù–ï–¢: visitedStanzas.clear()
}
```

**–†–∏—Å–∫:** –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –º–æ–∂–µ—Ç –Ω–µ —Å–∫—Ä–æ–ª–ª–∏—Ç—å –∫ —É–∂–µ –ø–æ—Å–µ—â–µ–Ω–Ω—ã–º –∫—É–ø–ª–µ—Ç–∞–º

**–†–µ—à–µ–Ω–∏–µ:** –û—á–∏—â–∞—Ç—å –≤ stopHighlighting –ò–õ–ò –≤ startHighlighting (—Å–µ–π—á–∞—Å –æ—á–∏—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ startHighlighting - —ç—Ç–æ –û–ö)

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ #3: scrollAnimator –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —Ä—É—á–Ω—ã–º —Å–∫—Ä–æ–ª–ª–æ–º
```javascript
scrollAnimator.scrollToLine(firstLine, {...});
```

**–†–∏—Å–∫:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç —Ä—É–∫–∞–º–∏ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è - –∞–Ω–∏–º–∞—Ü–∏—è –º–æ–∂–µ—Ç –¥–µ—Ä–≥–∞—Ç—å—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `comfortable` - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ

---

## 4. –ß—Ç–æ –±—ã–ª–æ —É–±—Ä–∞–Ω–æ

### ‚úÖ –£–±—Ä–∞–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ (—Å—Ç—Ä–æ–∫–∏ 470-472)
```javascript
// –£–ë–†–ê–ù–û:
sound.volume(1.0);  // –£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ —Å—Ç—Ä–æ–∫–µ 439!
Howler.volume(1.0);
```

### ‚úÖ monitorLoop/monitorOnce –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ setTimeout
**–ù–ï –£–ë–†–ê–ù–û** - –æ–∫–∞–∑–∞–ª–æ—Å—å —á—Ç–æ setTimeout –Ω—É–∂–µ–Ω! –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å monitorOnce() —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ play(), –∑–≤—É–∫ –µ—â–µ –Ω–µ playing –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:** –∑–∞–ø—É—Å–∫–∞—Ç—å monitorLoop/monitorOnce –≤–Ω—É—Ç—Ä–∏ —Ç–æ–≥–æ –∂–µ setTimeout —á—Ç–æ –∏ startHighlighting

### ‚ùå –í—ã–∫–ª—é—á–∏—Ç—å DEBUG –ª–æ–≥–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```javascript
var DEBUG_SCROLL = false;
var DEBUG_AUDIO = false;
```

---

## 5. –°–∏—Å—Ç–µ–º–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è Howler

–í–º–µ—Å—Ç–æ —Ç–∞–π–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è:

```javascript
sound = new Howl({
    src: [url],
    html5: true,
    onplay: function() {
        // –í—ã–∑–≤–∞—Ç—å startHighlighting –ö–û–ì–î–ê –∑–≤—É–∫ —Ä–µ–∞–ª—å–Ω–æ –∑–∞–∏–≥—Ä–∞–ª
        startHighlighting();
    },
    onseek: function() {
        // –°–±—Ä–æ—Å–∏—Ç—å —Ñ–ª–∞–≥ isRewinding –ö–û–ì–î–ê seek –∑–∞–≤–µ—Ä—à–µ–Ω
        isRewinding = false;
    },
    onstop: function() {
        stopHighlighting();
    }
});
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ—Ç –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª (150–º—Å, 300–º—Å)
- –ù–µ—Ç –≥–æ–Ω–æ–∫
- –ö–æ–¥ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –∞ –Ω–µ –≥–∞–¥–∞–µ—Ç –ø–æ —Ç–∞–π–º–µ—Ä–∞–º

---

## 6. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –°–µ–π—á–∞—Å (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏):
1. ‚úÖ –£–±—Ä–∞—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –≥—Ä–æ–º–∫–æ—Å—Ç–∏
2. ‚úÖ –í—ã–∫–ª—é—á–∏—Ç—å DEBUG –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
3. ‚úÖ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ monitorLoop/monitorOnce –≤ setTimeout (–±—ã–ª–æ —Ä–µ–≥—Ä–µ—Å—Å–∏—è)

### –ü–æ—Ç–æ–º (—Ç–µ—Ö–¥–æ–ª–≥, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):
4. ‚è≥ –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è Howler –≤–º–µ—Å—Ç–æ setTimeout
5. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –æ—á–∏—Å—Ç–∫—É —Ç–∞–π–º–µ—Ä–æ–≤ –≤ stopHighlighting
6. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –¥–ª—è sound.seek()

---

## –ò—Ç–æ–≥

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ –µ—Å—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –£–±—Ä–∞—Ç—å –æ—á–µ–≤–∏–¥–Ω—ã–π –º—É—Å–æ—Ä (3 –ø—Ä–∞–≤–∫–∏)
2. –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ —Å–æ–±—ã—Ç–∏—è (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≤—Ä–µ–º—è)
